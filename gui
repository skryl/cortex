#!/usr/bin/env ruby

require 'pry'
require 'pry-debugger'
require_relative 'htm'
require_relative 'scope/scope'

SCOPE_CONFIG = { panels: [
  { title: :stats, visible: true, selected: true, instruments: [

    {title: :activity, fg: :red, bg: :blue, type: :basic, visible: true,
     dataf: lambda { |htm| htm.columns }, 
     streamfs: [lambda { |c| c.active? ? '#' : ''}]},

    {title: :raw_overlap, fg: :white, bg: :yellow, type: :basic, visible: true,
     dataf: lambda { |htm| htm.columns }, 
     streamfs: [lambda { |c| c.raw_overlap.to_i }]}, 

    {title: :overlap, fg: :white, bg: :green, type: :basic, visible: true,
     dataf: lambda { |htm| htm.columns }, 
     streamfs: [lambda { |c| c.overlap.to_i }]}, 

    {title: :boost, fg: :red, bg: :yellow, type: :basic, visible: false,
     dataf: lambda { |htm| htm.columns }, 
     streamfs: [lambda { |c| c.boost }]},

    {title: :inputs, fg: :red, bg: :green, type: :basic, visible: true,
     dataf: lambda { |htm| htm.inputs }, 
     streamfs: [lambda { |c| c.active? ? '#' : '' }]}
  ]}, 
  { title: :synapse_indices, visible: true, selected: false, instruments: [
    {title: :synapse_indices, fg: :green, bg: :yellow, type: :minimal, visible: true,
     dataf: lambda { |htm| htm.columns.map(&:synapses)}, 
     streamfs: [lambda { |s| s.input.index }, 
                lambda { |s| s.active? ? '#' : '' }]} 
  ]}, 
  { title: :synapse_permancence, visible: true, selected: false, instruments: [
    {title: :synapse_perm, fg: :green, bg: :yellow, type: :minimal, visible: true,
     dataf: lambda { |htm| htm.columns.map(&:synapses)}, 
     streamfs: [lambda { |s| s.permanence }, 
                lambda { |s| s.active? ? '#' : '' }]} 
  ]}, 
  { title: :neighbor_indices, visible: true, selected: false, instruments: [
    {title: :neighbors, fg: :green, bg: :yellow, type: :minimal, visible: true,
     dataf: lambda { |htm| htm.columns.map(&:neighbors)}, 
     streamfs: [lambda { |n| n.index }, 
                lambda { |n| n.active? ? '#' : '' }]} 
  ]} 
]}

PATTERN = [[0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1],
           [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0]] 

Scope.new(HTM.new(pattern: PATTERN), SCOPE_CONFIG).start_scope
